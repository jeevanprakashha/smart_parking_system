<!DOCTYPE html>
<html lang="en">
<head>
    <title>Parking Lot First Floor</title>
    <link rel="stylesheet" href="/static/css/floors1.css">
    <script>
        function bookSlot(slotNumber, image) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };

                    // Send the location with the booking request
                    fetch('/book_slot', {
                        method: 'POST',
                        body: JSON.stringify({ 
                            slotNumber: slotNumber, 
                            latitude: userLocation.latitude, 
                            longitude: userLocation.longitude 
                        }),
                        headers: { 'Content-Type': 'application/json' }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log(`Slot booked: ${slotNumber}`);
                            // Change the image to indicate the slot is booked
                            image.src = "/static/images/car.png?time=" + new Date().getTime();
                        } else {
                            // Handle failure (slot already booked or user too far)
                            alert("Error: " + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error booking slot:', error);
                        alert("An error occurred. Please try again.");
                    });
                }, function(error) {
                    console.warn(`ERROR(${error.code}): ${error.message}`);
                    alert("Error retrieving your location.");
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }


        function loadSlots() {
            fetch('/get_slots')
                .then(response => response.json())
                .then(slots => {
                    slots.forEach(slot => {
                        const slotImage = document.querySelector(`input[value='${slot.slot_number}']`);
                        if (slotImage && slot.booked) {
                            slotImage.src = "/static/images/car.png"; // Path to the image for a booked slot
                        }
                    });
                })
                .catch(error => console.error('Error loading slots:', error));
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadSlots();
        });

    </script>
</head>
<body>
    <header>
        <div class = "title">
            <a href = "/index">Star Parking lot</a>
        </div>
        <div class = "nav">
            <div class="slider"></div>
            <div class = "nav-items">
                <a href="floors1.html" class="link">First Floor</a>
                <a href="floors2.html" class="link">Second Floor</a>
                <a href="floors3.html" class="link">Third Floor</a>
            </div>
        </div>
    </header>

    <section class="home">
        <div class = "content">
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.1" onclick="bookSlot('Slot 1.1', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.2" onclick="bookSlot('Slot 1.2', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.3" onclick="bookSlot('Slot 1.3', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.4" onclick="bookSlot('Slot 1.4', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.5" onclick="bookSlot('Slot 1.5', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.6" onclick="bookSlot('Slot 1.6', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.7" onclick="bookSlot('Slot 1.7', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.8" onclick="bookSlot('Slot 1.8', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.9" onclick="bookSlot('Slot 1.9', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.10" onclick="bookSlot('Slot 1.10', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.11" onclick="bookSlot('Slot 1.11', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.12" onclick="bookSlot('Slot 1.12', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.13" onclick="bookSlot('Slot 1.13', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.14" onclick="bookSlot('Slot 1.14', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.15" onclick="bookSlot('Slot 1.15', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.16" onclick="bookSlot('Slot 1.16', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.17" onclick="bookSlot('Slot 1.17', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.18" onclick="bookSlot('Slot 1.18', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.19" onclick="bookSlot('Slot 1.19', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.20" onclick="bookSlot('Slot 1.20', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.21" onclick="bookSlot('Slot 1.21', this)" />
        <div class = "road"></div>

            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.22" onclick="bookSlot('Slot 1.22', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.23" onclick="bookSlot('Slot 1.23', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.24" onclick="bookSlot('Slot 1.24', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.25" onclick="bookSlot('Slot 1.25', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.26" onclick="bookSlot('Slot 1.26', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.27" onclick="bookSlot('Slot 1.27', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.28" onclick="bookSlot('Slot 1.28', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.29" onclick="bookSlot('Slot 1.29', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.30" onclick="bookSlot('Slot 1.30', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.31" onclick="bookSlot('Slot 1.31', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.32" onclick="bookSlot('Slot 1.32', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.33" onclick="bookSlot('Slot 1.33', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.34" onclick="bookSlot('Slot 1.34', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.35" onclick="bookSlot('Slot 1.35', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.36" onclick="bookSlot('Slot 1.36', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.37" onclick="bookSlot('Slot 1.37', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.38" onclick="bookSlot('Slot 1.38', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.39" onclick="bookSlot('Slot 1.39', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.40" onclick="bookSlot('Slot 1.40', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.41" onclick="bookSlot('Slot 1.41', this)" />
            <input type="image" src="/images/pl1.png" width="50" height="200" class="gap" value="Slot 1.42" onclick="bookSlot('Slot 1.42', this)" />

        </div>

    </section>
</body>
</html>
